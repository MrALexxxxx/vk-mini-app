<!DOCTYPE html>
<html>
<head>
    <script>
        function onVkApiLoad() {
            document.getElementById('status').innerText = 'VK API загружен, инициализация...';
            console.log('vkapi.js загружен');
            VK.init({
                apiId: 53232316
            }, function() {
                document.getElementById('status').innerText = 'VK API инициализирован';
                console.log('VK API готов');
                document.getElementById('startButton').disabled = false;
            }, function(error) {
                document.getElementById('status').innerText = 'Ошибка инициализации: ' + error;
                console.error('Ошибка VK.init:', error);
            });
        }

        function onVkApiError(error) {
            document.getElementById('status').innerText = 'Ошибка загрузки vkapi.js: ' + error.message;
            console.error('Не удалось загрузить vkapi.js:', error);
        }
    </script>
    <script>
        try {
            document.getElementById('status').innerText = 'Попытка загрузки vkapi.js...';
            console.log('Начинаем загрузку vkapi.js');
        } catch (e) {
            console.error('Ошибка перед загрузкой:', e);
        }
    </script>
    <script src="https://vk.com/js/api/vkapi.js" onload="onVkApiLoad()" onerror="onVkApiError(event)"></script>
</head>
<body>
    <button onclick="startBot()" disabled id="startButton">Получить консультацию</button>
    <div id="status">Загрузка VK API...</div>
    <script>
        function startBot() {
            document.getElementById('status').innerText = 'Получение user_id...';
            VK.callMethod('users.get', {}, function(data) {
                if (data.error) {
                    document.getElementById('status').innerText = 'Ошибка users.get: ' + data.error.error_msg;
                    console.error('Ошибка users.get:', data.error);
                    return;
                }
                const userId = data.response[0].id;
                document.getElementById('status').innerText = 'Отправка сообщения для user_id: ' + userId;

                VK.api('messages.send', {
                    user_id: userId,
                    message: 'Bot started',
                    random_id: Math.floor(Math.random() * 2147483647),
                    access_token: 'vk1.a.F1Ns-Kx8tVjXslJ5oKyTzCcRMZz2QfINNHw8E76i3q3jmdYiDcndumIB_po7_tBikskIR3gir1AsqjrOAdA0HW8hAaoERXUq5uunamlYyfheuOeS-17-rnVml5TxsMMP1_V6KxApQCEgvQcyGCfamS4hbsXB12KwY3U-w0H5xU0AdeJfhjLQp4DSo9R1LUMZM6dLPe3Jsfjw47hjC3slHA',
                    v: '5.199'
                }, function(response) {
                    if (response.response) {
                        document.getElementById('status').innerText = 'Бот запущен!';
                        console.log('Сообщение отправлено');
                    } else {
                        document.getElementById('status').innerText = 'Ошибка messages.send: ' + response.error.error_msg;
                        console.error('Ошибка messages.send:', response.error);
                    }
                });
            });
        }
    </script>
</body>
</html>