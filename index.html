<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/@vkontakte/vk-bridge@2.1.0/dist/browser.min.js"></script>
    <script>
        window.vkBridge = window.vkBridge || vkBridge;

        document.addEventListener("DOMContentLoaded", async () => {
            try {
                await vkBridge.send("VKWebAppInit");
                console.log("VK Bridge инициализирован!");
                document.getElementById("startButton").disabled = false;
            } catch (error) {
                console.error("Ошибка инициализации VK Bridge:", error);
            }
        });

        async function startBot() {
            try {
                if (!vkBridge) {
                    console.error("VK Bridge не загружен!");
                    document.getElementById('status').innerText = 'Ошибка: VK Bridge не загружен';
                    return;
                }
                
                const user = await vkBridge.send("VKWebAppGetUserInfo");
                const userId = user.id;

                document.getElementById('status').innerText = 'Отправка запроса на сервер...';

                const response = await fetch("https://yourserver.com/start_bot", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_id: userId })
                });

                const result = await response.json();
                console.log("Ответ сервера:", result);

                document.getElementById('status').innerText = 'Бот запущен!';
            } catch (error) {
                console.error("Ошибка запуска бота:", error);
                document.getElementById('status').innerText = 'Ошибка запуска бота';
            }
        }
    </script>
</head>
<body>
    <button onclick="startBot()" id="startButton" disabled>Получить консультацию</button>
    <div id="status">Загрузка...</div>
</body>
</html>