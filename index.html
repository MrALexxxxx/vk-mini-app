<!DOCTYPE html>
<html>
<head>
    <script>
        let vkBridge;
        
        function loadVkBridge() {
            const script = document.createElement('script');
            script.src = "https://unpkg.com/@vkontakte/vk-bridge@2.1.0/dist/browser.min.js";
            script.onload = () => {
                vkBridge = window.vkBridge;
                console.log("VK Bridge загружен");
                initVkApp();
            };
            script.onerror = () => {
                console.error("Ошибка загрузки VK Bridge");
                document.getElementById('status').innerText = 'Ошибка загрузки VK Bridge';
            };
            document.head.appendChild(script);
        }
        
        async function initVkApp() {
            if (!vkBridge) {
                console.error("VK Bridge не инициализирован");
                return;
            }
            try {
                await vkBridge.send("VKWebAppInit");
                console.log("VK Bridge инициализирован!");
                document.getElementById("startButton").disabled = false;
            } catch (error) {
                console.error("Ошибка инициализации VK Bridge:", error);
                document.getElementById('status').innerText = 'Ошибка инициализации VK Bridge';
            }
        }

        async function startBot() {
            if (!vkBridge) {
                console.error("VK Bridge не загружен!");
                document.getElementById('status').innerText = 'Ошибка: VK Bridge не загружен';
                return;
            }
            try {
                const user = await vkBridge.send("VKWebAppGetUserInfo");
                const userId = user.id;

                document.getElementById('status').innerText = 'Отправка запроса на сервер...';

                const response = await fetch("https://yourserver.com/start_bot", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_id: userId })
                });

                const result = await response.json();
                console.log("Ответ сервера:", result);

                document.getElementById('status').innerText = 'Бот запущен!';
            } catch (error) {
                console.error("Ошибка запуска бота:", error);
                document.getElementById('status').innerText = 'Ошибка запуска бота';
            }
        }

        document.addEventListener("DOMContentLoaded", loadVkBridge);
    </script>
</head>
<body>
    <button onclick="startBot()" id="startButton" disabled>Получить консультацию</button>
    <div id="status">Загрузка...</div>
</body>
</html>